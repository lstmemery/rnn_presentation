<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fast.ai: Lesson 6</title>
    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/moon.css">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="css/solarized-dark.css">
    <!-- Printing and PDF exports -->
    <script>
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match(/print-pdf/gi) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h1>Fast.ai Lesson 6 Review</h1></section>
            <section>
                <ol>
                    <li>Pseudolabeling Revisited</li>
                    <li>Embeddings Revisited</li>
                    <li>RNNs</li>
                    <li>Theano/Tensorflow</li>
                </ol>
                <aside class="notes">Table of Contents Here</aside>
            </section>
            <section>
                <h1>Pseudolabeling Revisited</h1>
            </section>
            <section>
                <h1>Embeddings Revisited</h1>
            </section>
            <section>
                <section>
                    <h1>RNNs</h1>
                </section>
                <section>
                    <h2>Use cases for RNNs</h2>
                    <ul>
                        <li>Anything that requires knowledge of long term structure</li>
                        <li>Text data</li>
                        <!-- More -->
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h1>Three Character Model</h1>
                </section>
                <section>
                    <img src="img/3char_model.png">
                </section>
            	<section>
                <h2>Input</h2>
                <pre><code data-trim data-noescape>
char_indices = dict((c, i) for i, c in enumerate(chars))
indices_char = dict((i, c) for i, c in enumerate(chars))
				</code></pre>
                <aside class="notes">This creates a mapping of characters to integers. RNNs take numbers, not characters</aside>
                <!-- Not sure if this is needed -->
		        </section>
                <section>
                    <h2>Inputs and output</h2>
                                    <pre><code data-trim data-noescape>
cs=3
c1_dat = [idx[i] for i in range(0, len(idx)-1-cs, cs)]
c2_dat = [idx[i+1] for i in range(0, len(idx)-1-cs, cs)]
c3_dat = [idx[i+2] for i in range(0, len(idx)-1-cs, cs)]
c4_dat = [idx[i+3] for i in range(0, len(idx)-1-cs, cs)]
                        </code></pre>
                    <p>This creates a list of numbers. We need a matrix. So we create an embedding</p>
                </section>
		        <section>
		            <h2>Embedding</h2>
		            <p><pre>n_fac</pre> is a hyperparameter</p>
                <pre><code data-trim data-noescape>
def embedding_input(name, n_in, n_out):
    inp = Input(shape=(1,), dtype='int64', name=name)
    emb = Embedding(n_in, n_out, input_length=1)(inp)
    return inp, Flatten()(emb)
                </code></pre>
                <p>Parameters: 3570</p>
                <aside class="notes">Anyone know why int64 was used?
                Embedding layer is size (85 [Number of tokens], 42[Number of latent factors]) = 3570 parameters</aside>
		        </section>
                <section>
                    <img src="img/3char_model.png">
                </section>
                <section>
                    <h2>Input to Hidden Layer</h2>
                    <pre><code data-trim data-noescape>
n_hidden = 256
dense_in = Dense(n_hidden, activation='relu')
c1_hidden = dense_in(c1)
                    </code></pre>
                    <p>Parameters: 11008</p>
                    <aside class="notes">42[latent] * 256[hidden] + 256[biases]</aside>
                </section>
                <section>
                    <h2>Hidden to Hidden Layer</h2>
                                        <pre><code data-trim data-noescape>
from keras.layers.merge import add as merge_add
dense_hidden = Dense(n_hidden, activation='relu')
c2_dense = dense_in(c2)
hidden_2 = dense_hidden(c1_hidden)
c2_hidden = merge_add([c2_dense, hidden_2])  # Element-wise sum
                    </code></pre>
                    <p>Parameters: 65792</p>
                    <aside class="notes">256[previous latent] * 256[new latent] + 256[biases]</aside>
                </section>
                <section>
                    <h2>Hidden to Output Layer</h2>
                                        <pre><code data-trim data-noescape class="python">
c3_dense = dense_in(c3)
hidden_3 = dense_hidden(c2_hidden)
c3_hidden = merge_add([c3_dense, hidden_3])
dense_out = Dense(vocab_size, activation='softmax')
c4_out = dense_out(c3_hidden)
                    </code></pre>
                    <p>Parameters: 21845</p>
                    <!-- TODO: Talk about sparse categorical -->
                    <!-- TODO: Show results -->
                    <aside class="notes">256[previous latent] * 256[output] + 85[biases]</aside>
                </section>
            </section>
            <section>
                <section>
                    <h1>Nth Character Model</h1>
                </section>
                <section>
                    <h2>RNN forms:</h2>
                    <ol>
                        <li>Unrolled Form (previous example)</li>
                        <li>Recurrent Form (next example)</li>
                    </ol>
                    <p>Note: Jeremy mentioned that Tensorflow does not have the ability to make recurrent form RNNs. This is no longer true. Use `tf.nn.dynamic_rnn`.</p>
                    <aside class="notes">CNTK does not support dropout on recurrent form RNNs</aside> 
                </section>
                <section>
                <div style="text-align: left; float: left;">
                    <img style="height: 40%; width: 40%" src="img/nth_char_model.png">
                </div>
                <div style="text-align: right; float: right;">
                    <pre><code data-trim data-noescape class="python">
dense_in = Dense(n_hidden, activation='relu')
dense_hidden = Dense(n_hidden, activation='relu', 
                     kernel_initializer="identity")
dense_out = Dense(vocab_size, activation='softmax')
                    </code></pre>
                </div>
                </section>

                <section>
                    <h2>Combining layers</h2>
                    <pre><code data-trim data-noescape class="python">
hidden = dense_in(c_ins[0][1])
for i in range(1,cs):
    c_dense = dense_in(c_ins[i][1])
    hidden = dense_hidden(hidden)
    hidden = merge_add([c_dense, hidden])
c_out = dense_out(hidden)
                    </code></pre>
                    <p>This is common architecture. So Keras already has a version of it.</p>
                </section>
                <section>
                    <h2>Keras: SimpleRNN</h2>
                                        <pre><code data-trim data-noescape class="python">
model=Sequential([
        Embedding(vocab_size, n_fac, input_length=cs),
        SimpleRNN(n_hidden, activation='relu', recurrent_initializer='identity'),
        Dense(vocab_size, activation='softmax')
    ])
                    </code></pre>
                    <p>By setting recurrent_initializer = identity means do nothing by default</p>
                </section>
                <!-- Try the Twilight stuff later -->
            </section>
        </div>
    </div>
    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>
    <script>
    // More info about config & dependencies:
    // - https://github.com/hakimel/reveal.js#configuration
    // - https://github.com/hakimel/reveal.js#dependencies
    Reveal.initialize({
        dependencies: [
            { src: 'reveal.js/plugin/markdown/marked.js' },
            { src: 'reveal.js/plugin/markdown/markdown.js' },
            { src: 'reveal.js/plugin/notes/notes.js', async: true },
            { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
    });
    </script>
</body>

</html>